!function(){"use strict";angular.module("formioAppBasic",["ngSanitize","ui.router","ui.bootstrap","formio"]).provider("Resource",["$stateProvider",function(e){var r={};return{register:function(t,o,n){r[t]=t;var s=n&&n.parent?n.parent:null,a=t+"Id",i=function(e){var r={};return r[a]=e._id,r},u=function(e){return["$scope","$rootScope","$state","$stateParams","Formio","FormioUtils","$controller",e]},l=n&&n.templates?n.templates:{};e.state(t+"Index",{url:"/"+t,parent:s?s:null,params:n.params&&n.params.index,templateUrl:l.index?l.index:"views/resource/index.html",controller:u(function(e,r,s,u,l,m,c){e.currentResource={name:t,queryId:a,formUrl:o},e.$on("submissionView",function(e,r){s.go(t+".view",i(r))}),e.$on("submissionEdit",function(e,r){s.go(t+".edit",i(r))}),e.$on("submissionDelete",function(e,r){s.go(t+".delete",i(r))}),n&&n.index&&c(n.index,{$scope:e})})}).state(t+"Create",{url:"/create/"+t,parent:s?s:null,params:n.params&&n.params.create,templateUrl:l.create?l.create:"views/resource/create.html",controller:u(function(e,r,s,u,l,m,c){e.currentResource={name:t,queryId:a,formUrl:o},e.submission={data:{}};var f=!1;if(n&&n.create){var p=c(n.create,{$scope:e});f=p.handle||!1}f||e.$on("formSubmission",function(e,r){s.go(t+".view",i(r))})})}).state(t,{"abstract":!0,url:"/"+t+"/:"+a,parent:s?s:null,templateUrl:"views/resource.html",controller:u(function(e,r,i,u,l,m,c){var f=o+"/submission/"+u[a];e.currentResource=e[t]={name:t,queryId:a,formUrl:o,submissionUrl:f,formio:new l(f),resource:{},form:{},href:"/#/"+t+"/"+u[a]+"/",parent:s?e[s]:{href:"/#/",name:"home"}},e.currentResource.loadFormPromise=e.currentResource.formio.loadForm().then(function(r){e.currentResource.form=e[t].form=r}),e.currentResource.loadSubmissionPromise=e.currentResource.formio.loadSubmission().then(function(r){e.currentResource.resource=e[t].submission=r}),n&&n["abstract"]&&c(n["abstract"],{$scope:e})})}).state(t+".view",{url:"/",parent:t,params:n.params&&n.params.view,templateUrl:l.view?l.view:"views/resource/view.html",controller:u(function(e,r,t,o,s,a,i){n&&n.view&&i(n.view,{$scope:e})})}).state(t+".edit",{url:"/edit",parent:t,params:n.params&&n.params.edit,templateUrl:l.edit?l.edit:"views/resource/edit.html",controller:u(function(e,r,o,s,a,u,l){var m=!1;if(n&&n.edit){var c=l(n.edit,{$scope:e});m=c.handle||!1}m||e.$on("formSubmission",function(e,r){o.go(t+".view",i(r))})})}).state(t+".delete",{url:"/delete",parent:t,params:n.params&&n.params["delete"],templateUrl:l["delete"]?l["delete"]:"views/resource/delete.html",controller:u(function(e,r,t,o,a,i,u){var l=!1;if(n&&n["delete"]){var m=u(n["delete"],{$scope:e});l=m.handle||!1}l||e.$on("delete",function(){s&&"home"!==s?t.go(s+".view"):t.go("home",null,{reload:!0})})})})},$get:function(){return r}}}]).config(["$stateProvider","$urlRouterProvider","FormioProvider","AppConfig",function(e,r,t,o){t.setBaseUrl(o.apiUrl),e.state("home",{url:"/",templateUrl:"views/main.html"}).state("auth",{"abstract":!0,url:"/auth",templateUrl:"views/user/auth.html"}).state("auth.login",{url:"/login",templateUrl:"views/user/login.html",controller:["$scope","$state","$rootScope",function(e,r,t){e.$on("formSubmission",function(e,o){o&&(t.user=o,r.go("home"))})}]}).state("auth.register",{url:"/register",templateUrl:"views/user/register.html",controller:["$scope","$state","$rootScope",function(e,r,t){e.$on("formSubmission",function(e,o){o&&(t.user=o,r.go("home"))})}]}),r.otherwise("/")}]).factory("FormioAlerts",function(){var e=[];return{addAlert:function(r){e.push(r),r.element?angular.element("#form-group-"+r.element).addClass("has-error"):e.push(r)},getAlerts:function(){var r=angular.copy(e);return e.length=0,e=[],r},onError:function r(e){if(e.message)this.addAlert({type:"danger",message:e.message,element:e.path});else{var t=e.hasOwnProperty("errors")?e.errors:e.data.errors;angular.forEach(t,r.bind(this))}}}}).run(["$rootScope","$state","$stateParams","Formio","AppConfig","FormioAlerts",function(e,r,t,o,n,s){e.userForm=n.forms.userForm,e.userRegisterForm=n.forms.userRegisterForm,e.userLoginForm=n.forms.userLoginForm,angular.forEach(n.forms,function(r,t){e[t]=r}),e.user||o.currentUser().then(function(r){e.user=r});var a=function(){r.go("auth.login"),s.addAlert({type:"danger",message:"Your session has expired. Please log in again."})};e.$on("formio.sessionExpired",a),e.$on("formio.unauthorized",function(){r.go("home")}),e.logout=function(){o.logout().then(function(){r.go("auth.login")})["catch"](a)},e.isActive=function(e){return-1!==r.current.name.indexOf(e)},e.$on("$stateChangeStart",function(t,n){e.authenticated=!!o.getToken(),"auth"!==n.name.substr(0,4)&&"admin.login"!==n.name.substr(0,11)&&(e.authenticated||(t.preventDefault(),r.go("auth.login")))})}])}();